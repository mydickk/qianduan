<!DOCTYPE html> <html lang="en-US"><!--
 Page saved with SingleFile 
 url: https://interview2.poetries.top/fe-react-docs/react-ssr/docs/16-SSR双模式渲染支持以及其他细节梳理.html 
 saved date: Wed Aug 24 2022 22:45:01 GMT+0800 (China Standard Time)
--><head>
      <style type="text/css">
        @media screen and (min-width:850px){
          .sidebar-button{
            display: none
          }
          .sidebar{
            transform: translateX(0);
          }
        }
        @media screen and (max-width:850px){
          .sidebar-button{
            display: block
          }
        }
      </style>
      <script>
      document.onreadystatechange=function() {
        if(document.readyState == "complete"){ //当页面加载状态为完全结束时进入
          const sidebar = document.querySelector(".sidebar");
          document.querySelector(".sidebar-button").addEventListener("click", (e) => {
            if (!sidebar.style.transform || sidebar.style.transform === "translateX(-100%)") {
              sidebar.style.transform = "translateX(0)";
            } else {
              sidebar.style.transform = "translateX(-100%)";
            }
          });
          var throttle = function (func, delay) {
            var prev = Date.now();
            return function () {
              var context = this; //this指向window
              var args = arguments;
              var now = Date.now();
              if (now - prev >= delay) {
                func.apply(context, args);
                prev = Date.now();
              }
            };
          };
          window.onresize = throttle(function () {
            if (window.innerWidth > 850) {
              if (!sidebar.style.transform || sidebar.style.transform === "translateX(-100%)") {
                sidebar.style.transform = "translateX(0)";
              }
            }
          }, 1000);
        }
      }
      </script><meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>正文 | React相关</title>
    
    
  
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">
  
    
    
    <style>svg[data-v-49140617]{position:absolute;right:7.5px;cursor:pointer}svg.hover[data-v-49140617]{opacity:0}svg[data-v-49140617]:hover{opacity:1!important}span[data-v-49140617]{position:absolute;font-size:.85rem;line-height:.425rem;right:50px;opacity:0;-webkit-transition:opacity .5s;transition:opacity .5s}.code-copy-added:hover>.code-copy svg{opacity:.75}@-webkit-keyframes rotating{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotating{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes v-modal-in{0%{opacity:0}}@-webkit-keyframes v-modal-out{to{opacity:0}}.el-dialog__wrapper{position:fixed;top:0;right:0;bottom:0;left:0;overflow:auto;margin:0}@-webkit-keyframes dialog-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes dialog-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes dialog-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes dialog-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes v-modal-in{0%{opacity:0}}@keyframes v-modal-out{to{opacity:0}}@-webkit-keyframes msgbox-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes msgbox-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes msgbox-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes msgbox-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@-webkit-keyframes slideInRight-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@keyframes slideInRight-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@-webkit-keyframes slideInRight-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%);opacity:0}}@keyframes slideInRight-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%);opacity:0}}@-webkit-keyframes slideInLeft-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@keyframes slideInLeft-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@-webkit-keyframes slideInLeft-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%);opacity:0}}@keyframes slideInLeft-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%);opacity:0}}@-webkit-keyframes loading-rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes loading-rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes loading-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@keyframes loading-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@-webkit-keyframes progress{0%{background-position:0 0}to{background-position:32px 0}}@keyframes progress{0%{background-position:0 0}to{background-position:32px 0}}@-webkit-keyframes rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@-webkit-keyframes viewer-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes viewer-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes viewer-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes viewer-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@-webkit-keyframes el-drawer-fade-in{0%{opacity:0}to{opacity:1}}@keyframes el-drawer-fade-in{0%{opacity:0}to{opacity:1}}@-webkit-keyframes rtl-drawer-in{0%{-webkit-transform:translate(100%);transform:translate(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes rtl-drawer-in{0%{-webkit-transform:translate(100%);transform:translate(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes rtl-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(100%);transform:translate(100%)}}@keyframes rtl-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(100%);transform:translate(100%)}}@-webkit-keyframes ltr-drawer-in{0%{-webkit-transform:translate(-100%);transform:translate(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes ltr-drawer-in{0%{-webkit-transform:translate(-100%);transform:translate(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes ltr-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(-100%);transform:translate(-100%)}}@keyframes ltr-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(-100%);transform:translate(-100%)}}@-webkit-keyframes ttb-drawer-in{0%{-webkit-transform:translateY(-100%);transform:translateY(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes ttb-drawer-in{0%{-webkit-transform:translateY(-100%);transform:translateY(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes ttb-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(-100%);transform:translateY(-100%)}}@keyframes ttb-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(-100%);transform:translateY(-100%)}}@-webkit-keyframes btt-drawer-in{0%{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes btt-drawer-in{0%{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes btt-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(100%);transform:translateY(100%)}}@keyframes btt-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(100%);transform:translateY(100%)}}@-webkit-keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.icon.outbound{color:#aaa;display:inline-block;vertical-align:middle;position:relative;top:-1px}.nav-links{display:inline-block}.nav-links a{line-height:1.4rem;color:inherit}.nav-links a.router-link-active,.nav-links a:hover{color:#3eaf7c}.nav-links .nav-item{position:relative;display:inline-block;margin-left:1.5rem;line-height:2rem}.nav-links .nav-item:first-child{margin-left:0}@media (max-width:850px){.nav-links .nav-item{margin-left:0}}@media (min-width:850px){.nav-links a.router-link-active,.nav-links a:hover{color:#2c3e50}}.navbar{padding:.7rem 1.5rem;line-height:2.2rem}.navbar a{display:inline-block}.navbar .links{padding-left:1.5rem;box-sizing:border-box;background-color:#fff;white-space:nowrap;font-size:.9rem;position:absolute;right:1.5rem;top:.7rem;display:-webkit-box;display:flex}@media (max-width:850px){.navbar{padding-left:4rem}.navbar .can-hide{display:none}.navbar .links{padding-left:1.5rem}}.page-nav{max-width:740px;margin:0 auto;padding:2rem 2.5rem}@media (max-width:959px){.page-nav{padding:2rem}}@media (max-width:419px){.page-nav{padding:1.5rem}}.page-nav{padding-top:1rem;padding-bottom:0}.page-nav .inner{min-height:2rem;margin-top:0;border-top:1px solid #eaecef;padding-top:1rem;overflow:auto}.page-nav .next{float:right}.page{padding-bottom:2rem;overflow-x:hidden;display:block}@media only screen and (min-device-width:768px) and (max-device-width:1024px){.page{padding-bottom:20rem!important}}@media screen and (min-width:1200px){.theme-default-content:not(.custom){max-width:1300px!important}}.theme-default-content .content__default{position:relative}.theme-default-content .content__default pre{position:relative!important;padding-top:40px!important}.theme-default-content .content__default pre:after{content:"";position:absolute;top:9px;left:12px;z-index:1;width:10px;height:10px;border-radius:50%;background:#fc625d;box-shadow:20px 0#fdbc40,40px 0#35cd4b}@media screen and (min-width:700px){.theme-default-content .content__default h2{display:-webkit-inline-box;display:inline-flex;-webkit-box-align:center;align-items:center;font-weight:700;background:#ef7060;color:#fff;padding:3px 10px 4px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px;font-size:20px}.theme-default-content .content__default h2:after{content:"";display:inline-block;vertical-align:bottom;border-bottom:36px solid #efebe9;border-right:20px solid transparent;position:relative;left:32px;top:1px}.theme-default-content .content__default h2:before{content:"";border-bottom:2px solid #ef7060;width:100%;display:block;height:10px;position:absolute;margin-top:32px}}.theme-default-content .content__default code{color:#c7254e;background-color:#f9f2f4;font-size:14px;border-radius:5px;padding-left:5px;padding-right:5px;margin:auto 3px}@-webkit-keyframes upDown{0%{-webkit-transform:translateY(5px);transform:translateY(5px)}25%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(5px);transform:translateY(5px)}75%{-webkit-transform:translateY(0);transform:translateY(0)}to{-webkit-transform:translateY(5px);transform:translateY(5px)}}@keyframes upDown{0%{-webkit-transform:translateY(5px);transform:translateY(5px)}25%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(5px);transform:translateY(5px)}75%{-webkit-transform:translateY(0);transform:translateY(0)}to{-webkit-transform:translateY(5px);transform:translateY(5px)}}.sidebar-group:not(.collapsable) .sidebar-heading:not(.clickable){cursor:auto;color:inherit}.sidebar-heading{-webkit-transition:color .15s ease;transition:color .15s ease;cursor:pointer;font-size:1.1em;font-weight:700;padding:.35rem 1.5rem .35rem 1.25rem;width:100%;box-sizing:border-box;margin:0;border-left:.25rem solid transparent}.sidebar-heading.open,.sidebar-heading:hover{color:inherit}.sidebar-group-items{-webkit-transition:height .1s ease-out;transition:height .1s ease-out;font-size:.95em;overflow:hidden}.sidebar .sidebar-sub-headers{padding-left:1rem;font-size:.95em}a.sidebar-link{font-size:1em;font-weight:400;color:#2c3e50;border-left:.25rem solid transparent;padding:.35rem 1rem .35rem 1.25rem;line-height:1.4;width:100%;box-sizing:border-box}a.sidebar-link:hover{color:#3eaf7c}a.sidebar-link.active{font-weight:600;color:#3eaf7c;border-left-color:#3eaf7c}.sidebar-group a.sidebar-link{padding-left:2rem}.sidebar-sub-headers a.sidebar-link{padding-top:.25rem;padding-bottom:.25rem;border-left:none}.sidebar-sub-headers a.sidebar-link.active{font-weight:500}.sidebar ul{padding:0;margin:0;list-style-type:none}.sidebar a{display:inline-block}.sidebar>.sidebar-links{padding:1.5rem 0}.sidebar>.sidebar-links>li:not(:first-child){margin-top:.75rem}@media (max-width:850px){.sidebar>.sidebar-links{padding:1rem 0}}@-webkit-keyframes move{0%{-webkit-transform:translate(-175px) scale(1);transform:translate(-175px) scale(1)}50%{-webkit-transform:translate(-87px) scaleY(.5);transform:translate(-87px) scaleY(.5)}to{-webkit-transform:translate(0) scale(1);transform:translate(0) scale(1)}}@keyframes move{0%{-webkit-transform:translate(-175px) scale(1);transform:translate(-175px) scale(1)}50%{-webkit-transform:translate(-87px) scaleY(.5);transform:translate(-87px) scaleY(.5)}to{-webkit-transform:translate(0) scale(1);transform:translate(0) scale(1)}}.posr{position:relative}pre[class*=language-]{color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.theme-default-content code{padding:.25rem .5rem}.theme-default-content pre[class*=language-]{line-height:1.4;padding:1.25rem 1.5rem;margin:.85rem 0;background-color:#282c34;border-radius:6px;overflow:auto}.theme-default-content pre[class*=language-] code{color:#fff;padding:0;background-color:transparent;border-radius:0}div[class*=language-]{position:relative;background-color:#282c34;border-radius:6px}div[class*=language-] pre[class*=language-]{background:transparent;position:relative;z-index:1}div[class*=language-]:before{position:absolute;z-index:3;top:.8em;right:1em;font-size:.75rem;color:hsla(0,0%,100%,.4)}.theme-default-content:not(.custom){max-width:740px;margin:0 auto;padding:2rem 2.5rem}@media (max-width:959px){.theme-default-content:not(.custom){padding:2rem}}@media (max-width:419px){.theme-default-content:not(.custom){padding:1.5rem}}body,html{padding:0;margin:0;background-color:#fff}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:16px;color:#2c3e50}.page{padding-left:20rem}.navbar{z-index:20;right:0;height:3.6rem;background-color:#fff;box-sizing:border-box;border-bottom:1px solid #eaecef}.navbar{position:fixed;top:0;left:0}.sidebar{font-size:16px;background-color:#fff;width:20rem;position:fixed;z-index:10;margin:0;top:3.6rem;left:0;bottom:0;box-sizing:border-box;border-right:1px solid #eaecef;overflow-y:auto}.theme-default-content:not(.custom)>:first-child{margin-top:3.6rem}.theme-default-content:not(.custom) a:hover{text-decoration:underline}a{font-weight:500;text-decoration:none}a{color:#3eaf7c}ul{padding-left:1.2em}h2,h3{font-weight:600;line-height:1.25}h1:hover .header-anchor,h2:hover .header-anchor,h3:hover .header-anchor,h4:hover .header-anchor,h5:hover .header-anchor,h6:hover .header-anchor{opacity:1}h2{font-size:1.65rem;padding-bottom:.3rem;border-bottom:1px solid #eaecef}h3{font-size:1.35rem}a.header-anchor{font-size:.85em;float:left;margin-left:-.87em;padding-right:.23em;margin-top:.125em;opacity:0}a.header-anchor:hover{text-decoration:none}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}p,ul{line-height:1.7}@media (max-width:959px){.sidebar{font-size:15px;width:16.4rem}.page{padding-left:16.4rem}}@media (max-width:850px){.sidebar{top:0;padding-top:3.6rem;transform:translateX(-100%);transition:transform .2s ease}.page{padding-left:0}}@media (max-width:419px){.theme-default-content div[class*=language-]{margin:.85rem -1.5rem;border-radius:0}}</style>
  <style type="text/css"></style><meta name="description" content="React相关"><link rel="icon" href="data:image/png;base64,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"><style>.sf-hidden{display:none!important}</style><link rel="canonical" href="https://interview2.poetries.top/fe-react-docs/react-ssr/docs/16-SSR双模式渲染支持以及其他细节梳理.html"><meta http-equiv="content-security-policy" content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
  <body class>
    <div id="app"><div class="theme-container posr"><div><header class="navbar"> 
          <div class="sidebar-button" style="
          width: 1rem;
      "><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div>  <div class="links" style="max-width:1183px"> <nav class="nav-links can-hide"><div class="nav-item"><div><a href="./fe-react-docs-react-web-action-01-%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9A%84%E5%9B%9B%E4%B8%AA%E6%97%B6%E4%BB%A3.html" class="nav-link">React组合式开发
  </a></div></div><div class="nav-item"><div><a href="./fe-react-docs-react-improve-docs-01-%E5%89%8D%E8%A8%80.html" class="nav-link">React进阶
  </a></div></div><div class="nav-item"><div><a href="./fe-react-docs-react-ssr-docs-01-React%20SSR%20vs%20SSR%20vs%20CSR.html" class="nav-link">React服务端渲染
  </a></div></div><div class="nav-item"><div><a href="./fe-react-docs-im-chat-docs-01-%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" class="nav-link">IM聊天系统实践
  </a></div></div><div class="nav-item"><div><a href="./fe-react-docs-micro-fe-docs-01-%E5%BE%AE%E5%89%8D%E7%AB%AF%E7%9A%84%E8%AF%9E%E7%94%9F.html" class="nav-link">微前端开发实战
  </a></div></div> <!----></nav> </div></header></div> <div class="sidebar-mask sf-hidden"></div> <aside class="sidebar"><nav class="nav-links sf-hidden"> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>React SSR服务端渲染与同构实践</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="./fe-react-docs-react-ssr-docs-01-React%20SSR%20vs%20SSR%20vs%20CSR.html" class="sidebar-link">React SSR vs SSR vs CSR</a></li><li><a href="./fe-react-docs-react-ssr-docs-02-React%20SSR%20%E6%A0%B9%E6%9C%AC%E5%8E%9F%E7%90%86.html" class="sidebar-link">React SSR 根本原理</a></li><li><a href="./fe-react-docs-react-ssr-docs-03-%E5%AE%9E%E7%8E%B0%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%20React%20SSR.html" class="sidebar-link">实现最基本的 React SSR</a></li><li><a href="./fe-react-docs-react-ssr-docs-04-%E5%88%9D%E6%AD%A5%E8%AE%A4%E8%AF%86%E5%90%8C%E6%9E%84_%E4%BA%A4%E4%BA%92%E5%AE%9E%E7%8E%B0.html" class="sidebar-link">初步认识同构_交互实现</a></li><li><a href="./fe-react-docs-react-ssr-docs-05-%E5%BC%80%E5%8F%91%E4%BD%93%E9%AA%8C%E5%8D%87%E7%BA%A7.html" class="sidebar-link">开发体验升级</a></li><li><a href="./fe-react-docs-react-ssr-docs-06-%E5%8F%8C%E7%AB%AF%E8%B7%AF%E7%94%B1%E5%90%8C%E6%9E%84.html" class="sidebar-link">双端路由同构</a></li><li><a href="./fe-react-docs-react-ssr-docs-07-%E5%8F%8C%E7%AB%AF%E6%95%B0%E6%8D%AE%E5%90%8C%E6%9E%84.html" class="sidebar-link">双端数据同构</a></li><li><a href="./fe-react-docs-react-ssr-docs-08-SEO%20TDK%20%E6%94%AF%E6%8C%81.html" class="sidebar-link">SEO TDK 支持</a></li><li><a href="./fe-react-docs-react-ssr-docs-09-CSS%20%E8%B5%84%E6%BA%90%E5%A4%84%E7%90%86.html" class="sidebar-link">CSS 资源处理</a></li><li><a href="./fe-react-docs-react-ssr-docs-10-%E6%9E%84%E5%BB%BA%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83.html" class="sidebar-link">构建生产环境</a></li><li><a href="./fe-react-docs-react-ssr-docs-11-%E5%8F%8C%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%BC%8F%E7%83%AD%E6%9B%B4%E6%96%B0.html" class="sidebar-link">双服务模式热更新</a></li><li><a href="./fe-react-docs-react-ssr-docs-12-%E5%9F%BA%E4%BA%8E%E8%B7%AF%E7%94%B1%E7%9A%84%E6%8C%89%E9%9C%80%E6%B8%B2%E6%9F%93.html" class="sidebar-link">基于路由的按需渲染</a></li><li><a href="./fe-react-docs-react-ssr-docs-13-%E4%BD%BF%E7%94%A8%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E4%BC%98%E5%8C%96%E6%95%B0%E6%8D%AE%E5%90%8C%E6%9E%84.html" class="sidebar-link">使用高阶组件优化数据同构</a></li><li><a href="./fe-react-docs-react-ssr-docs-14-CSS%20%E8%B5%84%E6%BA%90%E5%90%8C%E6%9E%84%E7%9B%B4%E5%87%BA.html" class="sidebar-link">CSS 资源同构直出</a></li><li><a href="./fe-react-docs-react-ssr-docs-15-%E6%B7%BB%E5%8A%A0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%20redux.html" class="sidebar-link">添加状态管理 redux</a></li><li><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html" class="active sidebar-link">SSR双模式渲染支持以及其他细节梳理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%AD%A3%E6%96%87" class="sidebar-link">正文</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#ssr-csr-%E4%B8%A4%E7%A7%8D%E6%B8%B2%E6%9F%93%E6%A8%A1%E5%BC%8F%E6%94%AF%E6%8C%81" class="sidebar-link">ssr/csr 两种渲染模式支持</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" class="sidebar-link">跨平台设置环境变量</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97-hack" class="sidebar-link">前端模块 hack</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%97%A0%E6%B3%95%E8%B7%A8%E7%AB%AF%E8%AE%BF%E9%97%AE" class="sidebar-link">无法跨端访问</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B9%B3%E5%8F%B0%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98" class="sidebar-link">子进程的平台兼容问题</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%8F%96%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0" class="sidebar-link">数据预取方法参数</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E9%A1%B5%E9%9D%A2%E7%BA%A7%E6%B8%B2%E6%9F%93%E5%8F%AF%E6%8E%A7" class="sidebar-link">页面级渲染可控</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E9%85%8D%E5%A5%97-cli-%E5%B7%A5%E5%85%B7" class="active sidebar-link">配套 cli 工具</a></li><li class="sidebar-sub-header"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%B0%8F%E7%BB%93" class="sidebar-link">小结</a></li></ul></li><li><a href="./fe-react-docs-react-ssr-docs-17-%E5%AF%B9%E6%AF%94%E4%B8%9A%E5%86%85%E5%B7%B2%E6%9C%89%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%9E%E7%8E%B0.html" class="sidebar-link">对比业内已有框架的实现</a></li><li><a href="./fe-react-docs-react-ssr-docs-18-React%20SSR%20%E9%A1%B9%E7%9B%AE%E5%AE%9E%E6%88%98.html" class="sidebar-link">React SSR 项目实战</a></li></ul></section></li></ul> </aside> <main class="page"> <div id="container" class="theme-default-content"><div class="content__default"><h2 id="正文"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%AD%A3%E6%96%87" class="header-anchor">#</a> 正文</h2> <p>本节主要是补充一下以前没有提到的一些细节和一些问题以及解决思路，以便于我们可以更方便的应用本骨架进行业务开发，减少前期的一些时间准备成本。</p> <p>本来打算将<code>csr/ssr</code>双模式渲染作为独立章节来说，但是具体的实现很简单，作为独立章节的话又确实没必要。</p> <p>但是这个特性又非常重要，所以干脆将内容进行压缩一下，只说主要的部分，同时将本骨架的其他的一些细节合在一起介绍吧。</p> <h2 id="ssr-csr-两种渲染模式支持"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#ssr-csr-%E4%B8%A4%E7%A7%8D%E6%B8%B2%E6%9F%93%E6%A8%A1%E5%BC%8F%E6%94%AF%E6%8C%81" class="header-anchor">#</a> ssr/csr 两种渲染模式支持</h2> <p>目前我们的骨架只是单纯的支持了<code>ssr</code>模式下的开发和运行，其实我们还可以做一个扩展，多加一个运行模式<code>csr</code>模式，这样整个应用就可以支持两种渲染模式。</p> <p>我们可以根据需要来进行切换渲染模式，当应用的负载过大的时候我们也可以方便的切换为单页应用，这种临时处理方案可以迅速的降低服务器的压力。</p> <h3 id="实现说明"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%AE%9E%E7%8E%B0%E8%AF%B4%E6%98%8E" class="header-anchor">#</a> 实现说明</h3> <p>具体的实现很简单，我们在全局配置文件内增加一个配置，用于表示渲染模式。</p> <p>我们目前是<code>ssr</code>模式，如果当前是<code>csr</code> 模式的话只需要返回一个空的<code>html</code>结构,然后向浏览器注入一个全局变量，表示当前的渲染模式。</p> <p>其他的<code>css/js</code>资源正常按照<code>ssr</code>下的模式直出即可。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>增加一个全局设置
// ./src/share/pro-config.js
//双端公用的配置文件

module.exports = {
    __IS_SSR__:false,//是否为 ssr 模式
    wdsPort:9002,//wds 服务的运行端口
    nodeServerPort:9001,//node server 的监听端口
    asyncComponentKey:'__IS_ASYNC_COMP_FLAG__'//标志组件是否是按需加载 turn | false
}
服务端模式判断
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>我们在<code>ssr</code>中间件对渲染模式进行判断，如果是<code>csr</code>则返回一个空的页面骨架。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>let html="";//组件渲染结果
 if (proConfig.__IS_SSR__){
 //匹配路由
 //数据预取
 //组件渲染
 }

//...

    ctx.body = `&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;${tdk.title}&lt;/title&gt;
    &lt;meta name="keywords" content="${tdk.keywords}" /&gt;
    &lt;meta name="description" content="${tdk.description}" /&gt;
     ${assetsMap.css.join('')}
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="root"&gt;
       ${html}
    &lt;/div&gt;
    &lt;textarea id="ssrTextInitData" style="display:none;"&gt;
    ${JSON.stringify(fetchResult)}
    &lt;/textarea&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;/body&gt;
&lt;script&gt;
//注入全局渲染模式
window.__IS__SSR__=${proConfig.__IS_SSR__};
&lt;/script&gt;
 ${assetsMap.js.join('')}
`;
高阶组件调整
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>我们的高阶组件<code>PageContainer</code>用来管理客户端页面在路由切换时是否进行异步获取数据，所以当前若是<code>csr</code>模式，则每次在<code>componentDidMount</code>内直接获取数据,也不需要监听<code>popstate</code>事件了。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>// src/client/common/components/page-container/index.js

//...

async componentDidMount() {
            
            _this = this; // 修正_this指向，保证_this指向当前渲染的页面组件
            //只有当前是ssr模式才会注册事件，用于在页面切换时候触发
            window.__IS__SSR &amp;&amp; window.addEventListener('popstate', popStateCallback);

            const canClientFetch = this.props.history &amp;&amp; this.props.history.action === 'PUSH';//路由跳转的时候可以异步请求数据

            if (canClientFetch || !window.__IS__SSR) {//如果是 csr 模式，每次都需要异步请求数据
                await this.getInitialProps();
            }
        }


//...
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>完整代码：<a href="https://github.com/Bigerfe/koa-react-ssr/blob/better/packages/my-react-ssr-dataisobetter/src/client/common/components/page-container/index.js" target="_blank" rel="noopener noreferrer">github.com/Bigerfe/koa…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>看下整体的页面输出结果
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;默认标题 - my react ssr&lt;/title&gt;
    &lt;meta name="keywords" content="默认关键词" /&gt;
    &lt;meta name="description" content="默认描述" /&gt;
     &lt;link rel="stylesheet" type="text/css" href="//localhost:9002/styles.css" /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id="root"&gt;
       
    &lt;/div&gt;
    &lt;textarea id="ssrTextInitData" style="display:none;"&gt;
    {}
    &lt;/textarea&gt;
&lt;/body&gt;
&lt;/html&gt;
&lt;/body&gt;
&lt;script&gt;
//定义当前的渲染模式
window.__IS__SSR__=false;
&lt;/script&gt;
 &lt;script type="text/javascript"  src="//localhost:9002/libs.js"&gt;&lt;/script&gt;&lt;script type="text/javascript"  src="//localhost:9002/main.js"&gt;&lt;/script&gt;&lt;script type="text/javascript"  src="//localhost:9002/styles.js"&gt;&lt;/script&gt;
模式热切换
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>我们现在是将渲染模式放到了配置文件内，手动切换模式后需要重启<code>node</code>进程，如果想做到动态切换可以将配置值从接口来获取,这样不需要重启 <code>node</code>服务。</p> <p>ok，到这里双模式支持完成。</p> <h2 id="跨平台设置环境变量"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F" class="header-anchor">#</a> 跨平台设置环境变量</h2> <p>在使用<code>npm scripts</code>运行本骨架时会设置环境变量，目前只能在<code>mac</code>系统运行正常，<code>windows</code>下运行会报错。</p> <p>所以需要使用<code>cross-env</code>来进行环境变量的设置，该库能够以<code>unix</code>方式设置环境变量，然后在<code>windows</code>上也能兼容运行。</p> <p>改造后的命令为</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>"scripts": {
    //...
    "build": "cross-env NODE_ENV=production npm run client:build &amp;&amp; npm run server:build",
    "client:build": "cross-env NODE_ENV=production webpack --config  ./webpack/webpack.prod.config.js",
    "server:build": "cross-env NODE_ENV=production webpack --config  ./webpack/webpack.server.config.js",
    //...
    "wds:watch": "cross-env BABEL_ENV=development node ./webpack/scripts/wds-start.js"
  },
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h2 id="前端模块-hack"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97-hack" class="header-anchor">#</a> 前端模块 hack</h2> <p><code>react ssr</code>开发骨架的核心是<code>同构</code>,也就是双端会运行同一套代码，所以一些用于浏览器端的模块就会在服务器端执行，然而此时就会报错。</p> <p>因为<code>document window</code>都是浏览器的对象，<code>node</code>里不存在。</p> <p>那我们应该解决这个问题呢？</p> <h3 id="最直接的方式"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%9C%80%E7%9B%B4%E6%8E%A5%E7%9A%84%E6%96%B9%E5%BC%8F" class="header-anchor">#</a> 最直接的方式</h3> <p>直接在<code>node global</code>上增加相关缺失的属性</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>global.document={};
global.window={};
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>这种方式虽然可行，但是比较辛苦。如果是多级访问的对象可就更麻烦了。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>document.location.hash
document.location.hash={};
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>所以这个方式并不好，放弃吧。</p> <h3 id="使用babel插件"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E4%BD%BF%E7%94%A8babel%E6%8F%92%E4%BB%B6" class="header-anchor">#</a> 使用babel插件</h3> <p>最彻底的办法是不让服务端加载浏览器模块，所以我们可以写一个插件，在代码打包的时候将导入的模块替换为<code>{}</code>。</p> <p>和我们前面小节中过滤掉组件内的 <code>css</code>模块的方式一致。</p> <p>这个方式在我这个开发骨架<code>1.0</code>版本的时候使用过。</p> <p>所以最终运行在服务端代码会变为</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>import React from 'react';

- import dom from './dom';

+ const xxMd = {};
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>这个方式可以彻底解决，但是实现有些复杂了。其实还有更简单的方式，往下看。</p> <p>既然不是最好的，就不做过多介绍了。</p> <h3 id="使用动态加载"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E4%BD%BF%E7%94%A8%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD" class="header-anchor">#</a> 使用动态加载</h3> <p>使用我们在<code>webpack</code>内定义的全局变量<code>__SERVER__</code>,结合使用<code>require</code>运行时执行来实现。</p> <p>这样服务端就彻底不会加载这个前端模块了。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>//当前环境是服务端 则 dom={} 
const dom = __SERVER__ ? {} : require('./dom').default;
测试模块
// dom.js 

console.log(window.location.href);

export default {
    log(){
        console.log(window.location.href);
    }
}
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h2 id="无法跨端访问"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%97%A0%E6%B3%95%E8%B7%A8%E7%AB%AF%E8%AE%BF%E9%97%AE" class="header-anchor">#</a> 无法跨端访问</h2> <p>目前本骨架在本地开发服务为双服务模式，一个是<code>node server</code>绑定的是<code>9001</code>端口，另一个是静态资源<code>webpack-dev-server</code>启动的服务绑定端口为<code>9002</code>，而骨架内的静态资源<code>host</code>地址为<code>localhost</code>，所以只能在本地访问，无法在其他设备或者终端访问。</p> <h3 id="改造思路-1"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%94%B9%E9%80%A0%E6%80%9D%E8%B7%AF-1" class="header-anchor">#</a> 改造思路 1</h3> <p>通过本机<code>ip</code>启动<code>node server</code>,同时其静态资源地址统一为<code>ip</code>地址即可。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>获取本机ip
const os = require('os');

function getNetworkAddress() {
    const interfaces = os.networkInterfaces();
    for (const name of Object.keys(interfaces)) {
        for (const interface of interfaces[name]) {
            const { address, family, internal } = interface;
            if (family === 'IPv4' &amp;&amp; !internal) {
                return address;
            }
        }
    }
}
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>然后调整<code>wds</code>和<code>webpack.dev.config</code>的相关配置</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>// webpack-dev-server.config

  output: {
        filename: '[name].js',
        path: resolvePath('../dist/static'),
        //设置静态资源地址通过 ip 访问
        publicPath: `http://${__LOCAL_IP__}:${proConfig.wdsPort}/`
    },
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>设置<code>wds</code>选项的<code>host</code>为本机 <code>ip</code></p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>// ./webpack/webpack-dev-server.config
module.exports = function (port, publicPath) {
    return {
        host: global.__LOCAL_IP__//本机 ip，这里我提前把 ip 作为一个全局变量
    //...
    }
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h3 id="改造方案-2"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%94%B9%E9%80%A0%E6%96%B9%E6%A1%88-2" class="header-anchor">#</a> 改造方案 2</h3> <p>使用<code>node server</code> 进行请求转发。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>module.exports = {
  proxy: {
    host: 'http://127.0.0.1:9002', // 本地开发时,代理前端打包出来的静态资源
    match: /(\/static)|(\/sockjs-node)|(\/__webpack_dev_server__)|hot-update/
  }
}
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h2 id="子进程的平台兼容问题"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B9%B3%E5%8F%B0%E5%85%BC%E5%AE%B9%E9%97%AE%E9%A2%98" class="header-anchor">#</a> 子进程的平台兼容问题</h2> <p>我们本地开发时执行<code>npm run dev</code>命令，内部会创建多个子进程。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>const {spawn} = require('child_process');//用于创建子进程

//wds 服务
const feCodeWatchProcess = spawn('npm', ['run', 'wds:watch',localHostIp], { stdio: 'inherit' });

//服务端代码监控和编译进程
const svrCodeWatchProcess = spawn('npm', ['run', 'svr:watch']);

//....
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>但上面<code>spawn</code>使用方式在<code>windows</code>系统上会报错。</p> <p>原因：当执行 <code>npm</code> 时，实际执行的是 <code>npm.cmd</code> 批处理，而在<code>windows</code>上，<code>.cmd</code>, <code>.bat</code> 批处理是无法脱离 <code>cmd.exe</code>解释器而单独运行的。</p> <h3 id="解决方法1"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%951" class="header-anchor">#</a> 解决方法1</h3> <p>调用 <code>spawn</code> 函数时，设置 <code>shell</code> 选项为 <code>true</code> 以隐式地调用 <code>cmd</code>。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>spawn('npm', {
  stdio: 'inherit',
  shell: true
});
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>优化一下,毕竟在<code>mac</code>上不需要此设置</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>const child = cp.spawn('npm', ['run', 'build'], { shell: process.platform === 'win32' });
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h3 id="解决方法-2"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95-2" class="header-anchor">#</a> 解决方法 2</h3> <p>除了自己编写代码的时候做处理，也有第三方模块<code>cross-spawn</code>。</p> <p>使用该模块，可以在调用 <code>spawn</code> 函数时，自动根据当前的运行平台，来决定是否生成一个 <code>shell</code> 来执行所给的命令。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>npm install cross-spawn

const spawn = require('cross-spawn');
 
spawn('npm', {
  stdio: 'inherit'
});
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h2 id="数据预取方法参数"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%8F%96%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0" class="header-anchor">#</a> 数据预取方法参数</h2> <p>在前面小节内，我们的数据预取都是获取的假数据，所以没有提关于一些动态参数的传递问题。但在实际业务中是离不开的。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>//还没有传递参数
Index.getInitialProps= async ()=&gt;{
    console.log('fetch data index');
    //模拟数据请求方法
    //...

    return {
        page: {
            tdk: {
                title: '首页 - koa-react-ssr',
                keywords: '关键词 - koa-react-ssr',
                description: '描述'
            }
        }
    };
}
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>所以这里单独说明下需要传递的参数。</p> <p>最基本的参数有路由<code>params</code>和<code>url query</code>。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>路由params
    {
        path: '/list/:id',//id 的获取
        component:A,
        exact: true
    },
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p><code>url</code>透传的参数</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>//获取 a b 值
http://localhost:9001/list/100?a=1&amp;b=2
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h3 id="约定参数"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E7%BA%A6%E5%AE%9A%E5%8F%82%E6%95%B0" class="header-anchor">#</a> 约定参数</h3> <p>我们可以约定函数的参数如下</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>Index.getInitialProps= async ({match,location})=&gt;{
    //...
}
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h3 id="客户端处理"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%A4%84%E7%90%86" class="header-anchor">#</a> 客户端处理</h3> <p>上面两个参数可以在组件的<code>props</code>属性获取。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>var match = this.props.match;
var location = this.props.location;
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>所以只需要在调用的时候带入<code>props</code>即可。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code> //用于封装处理
 async getInitialProps(){
            //ssr首次进入页面以及csr/ssr切换路由时才调用组件的getInitialProps方法
            const {match,location} = this.props;
            const res =  SourceComponent.getInitialProps ? await SourceComponent.getInitialProps({match,location}) : {};
            //...
        }
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h3 id="服务端处理"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%A4%84%E7%90%86" class="header-anchor">#</a> 服务端处理</h3> <p>在服务端调用数据预取方法时，路由的匹配结果会返回<code>match</code>结果，结果内包含了<code>params</code>。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code> //查找到的目标路由对象
    let matchResult = await matchRoute(path, staticRoutesList);
    //targetMatch 包含参数信息
    let { targetRoute, targetMatch } = matchResult;
    
//...targetMatch 
{ path: '/list', url: '/list', isExact: true, params: {} }
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>另外<code>location</code>就可以通过<code>ndoe server context</code>来获取了,具体代码就省略了。</p> <p>除了这两个基础参数外，可能还需要对服务端做一些单独的处理，所以我们可以带入<code>req</code>，<code>res</code>对象。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>Index.getInitialProps= async ({match,location,req,res})=&gt;{
    if(req){
        //服务端处理
    }
}
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><h2 id="页面级渲染可控"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E9%A1%B5%E9%9D%A2%E7%BA%A7%E6%B8%B2%E6%9F%93%E5%8F%AF%E6%8E%A7" class="header-anchor">#</a> 页面级渲染可控</h2> <p>这里只是提一个想法，在我们的项目中存在很多页面，可能有些页面根本不需要考虑<code>SEO</code>,所以也就不需要<code>ssr</code>。</p> <p>所以我们需要做到对页面级的渲染模式可控。</p> <p>可以约定为组件添加一个静态属性，该属性表示当前页面是否开启<code>ssr</code>渲染。</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>class Index{
    
}

Index.__OPEN_SSR__=false;//关闭 ssr
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><p>然后在服务端匹配路由时，就可以通过对该属性进行逻辑判断当前页面是否需要做<code>ssr</code>。</p> <h2 id="配套-cli-工具"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E9%85%8D%E5%A5%97-cli-%E5%B7%A5%E5%85%B7" class="header-anchor">#</a> 配套 cli 工具</h2> <p>一个完整的开发框架一般都会配<code>cli</code>脚手架工具，可以在命令行下帮我们快速的创建项目开发模板。</p> <p>像<code>react</code>的<code>create-react-app</code>，<code>vue</code>的<code>vue-cli</code>。</p> <p>本骨架的<code>cli</code>工具目前已经开发完成，具体的实现方式很简单,所以就不做具体介绍了。</p> <p><code>cli</code>项目源码： <a href="https://github.com/Bigerfe/zzjs-cli" target="_blank" rel="noopener noreferrer">github.com/Bigerfe/zzj…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>另外具体的实现可以参考下面文章，写的很不错</p> <p><a href="https://mp.weixin.qq.com/s/CO6La0NCHnsfXN4MHgiBag" target="_blank" rel="noopener noreferrer">mp.weixin.qq.com/s/CO6La0NCH…<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="小结"><a href="./fe-react-docs-react-ssr-docs-16-SSR%E5%8F%8C%E6%A8%A1%E5%BC%8F%E6%B8%B2%E6%9F%93%E6%94%AF%E6%8C%81%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%BB%86%E8%8A%82%E6%A2%B3%E7%90%86.html#%E5%B0%8F%E7%BB%93" class="header-anchor">#</a> 小结</h2> <p>本小节主要是总结性的说明下之前我们没有涉及到细节，包括一些问题和扩展方案。</p> <p>这些应该算是比较基础的，也比较容易发现的，其实还有很多可以扩展的地方。比如路由配置，现在是集中配置，其实这种方式并不利于维护，或许我们可以参考<code>next.js</code>的约定式路由来改造一下。</p> <p>其他更多的扩展，可能需要在后期的使用中逐步的挖掘和完善，好在，这个骨架是白盒的，你可以灵活定制。</p></div> <!----> <!----></div>  <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="./fe-react-docs-react-ssr-docs-15-%E6%B7%BB%E5%8A%A0%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86%20redux.html" class="prev">添加状态管理 redux</a></span> <span class="next"><a href="./fe-react-docs-react-ssr-docs-17-%E5%AF%B9%E6%AF%94%E4%B8%9A%E5%86%85%E5%B7%B2%E6%9C%89%E6%A1%86%E6%9E%B6%E7%9A%84%E5%AE%9E%E7%8E%B0.html" class>对比业内已有框架的实现</a>
      →
    </span></p></div>  </main> <div class="el-dialog__wrapper" style="display:none"></div> <div class="el-dialog__wrapper" style="display:none"></div> <div class="el-dialog__wrapper" style="display:none"></div> <div class="el-dialog__wrapper" style="display:none"></div></div><div class="global-ui"><!----></div></div>
    
  

</body></html>