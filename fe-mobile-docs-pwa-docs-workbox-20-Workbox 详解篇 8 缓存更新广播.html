<!DOCTYPE html> <html lang="en-US"><!--
 Page saved with SingleFile 
 url: https://interview2.poetries.top/fe-mobile-docs/pwa-docs/workbox/20-Workbox 详解篇 8 缓存更新广播.html 
 saved date: Wed Aug 24 2022 22:28:38 GMT+0800 (China Standard Time)
--><head>
      <style type="text/css">
        @media screen and (min-width:850px){
          .sidebar-button{
            display: none
          }
          .sidebar{
            transform: translateX(0);
          }
        }
        @media screen and (max-width:850px){
          .sidebar-button{
            display: block
          }
        }
      </style>
      <script>
      document.onreadystatechange=function() {
        if(document.readyState == "complete"){ //当页面加载状态为完全结束时进入
          const sidebar = document.querySelector(".sidebar");
          document.querySelector(".sidebar-button").addEventListener("click", (e) => {
            if (!sidebar.style.transform || sidebar.style.transform === "translateX(-100%)") {
              sidebar.style.transform = "translateX(0)";
            } else {
              sidebar.style.transform = "translateX(-100%)";
            }
          });
          var throttle = function (func, delay) {
            var prev = Date.now();
            return function () {
              var context = this; //this指向window
              var args = arguments;
              var now = Date.now();
              if (now - prev >= delay) {
                func.apply(context, args);
                prev = Date.now();
              }
            };
          };
          window.onresize = throttle(function () {
            if (window.innerWidth > 850) {
              if (!sidebar.style.transform || sidebar.style.transform === "translateX(-100%)") {
                sidebar.style.transform = "translateX(0)";
              }
            }
          }, 1000);
        }
      }
      </script><meta charset="utf-8">
    
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>移动端相关</title>
    
    
  
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="apple-mobile-web-app-status-bar-style">
  
    
    
    <style>svg[data-v-49140617]{position:absolute;right:7.5px;cursor:pointer}svg.hover[data-v-49140617]{opacity:0}svg[data-v-49140617]:hover{opacity:1!important}span[data-v-49140617]{position:absolute;font-size:.85rem;line-height:.425rem;right:50px;opacity:0;-webkit-transition:opacity .5s;transition:opacity .5s}.code-copy-added:hover>.code-copy svg{opacity:.75}@-webkit-keyframes rotating{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotating{0%{-webkit-transform:rotate(0);transform:rotate(0)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes v-modal-in{0%{opacity:0}}@-webkit-keyframes v-modal-out{to{opacity:0}}.el-dialog__wrapper{position:fixed;top:0;right:0;bottom:0;left:0;overflow:auto;margin:0}@-webkit-keyframes dialog-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes dialog-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes dialog-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes dialog-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes v-modal-in{0%{opacity:0}}@keyframes v-modal-out{to{opacity:0}}@-webkit-keyframes msgbox-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes msgbox-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes msgbox-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes msgbox-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@-webkit-keyframes slideInRight-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@keyframes slideInRight-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@-webkit-keyframes slideInRight-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%);opacity:0}}@keyframes slideInRight-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(100%);transform:translateX(100%);opacity:0}}@-webkit-keyframes slideInLeft-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@keyframes slideInLeft-enter{0%{opacity:0;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%)}to{opacity:1;-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0)}}@-webkit-keyframes slideInLeft-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%);opacity:0}}@keyframes slideInLeft-leave{0%{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(0);transform:translateX(0);opacity:1}to{-webkit-transform-origin:0 0;transform-origin:0 0;-webkit-transform:translateX(-100%);transform:translateX(-100%);opacity:0}}@-webkit-keyframes loading-rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes loading-rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes loading-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@keyframes loading-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}@-webkit-keyframes progress{0%{background-position:0 0}to{background-position:32px 0}}@keyframes progress{0%{background-position:0 0}to{background-position:32px 0}}@-webkit-keyframes rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes rotate{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@-webkit-keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@-webkit-keyframes viewer-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@keyframes viewer-fade-in{0%{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}to{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}}@-webkit-keyframes viewer-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@keyframes viewer-fade-out{0%{-webkit-transform:translateZ(0);transform:translateZ(0);opacity:1}to{-webkit-transform:translate3d(0,-20px,0);transform:translate3d(0,-20px,0);opacity:0}}@-webkit-keyframes el-drawer-fade-in{0%{opacity:0}to{opacity:1}}@keyframes el-drawer-fade-in{0%{opacity:0}to{opacity:1}}@-webkit-keyframes rtl-drawer-in{0%{-webkit-transform:translate(100%);transform:translate(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes rtl-drawer-in{0%{-webkit-transform:translate(100%);transform:translate(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes rtl-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(100%);transform:translate(100%)}}@keyframes rtl-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(100%);transform:translate(100%)}}@-webkit-keyframes ltr-drawer-in{0%{-webkit-transform:translate(-100%);transform:translate(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes ltr-drawer-in{0%{-webkit-transform:translate(-100%);transform:translate(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes ltr-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(-100%);transform:translate(-100%)}}@keyframes ltr-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translate(-100%);transform:translate(-100%)}}@-webkit-keyframes ttb-drawer-in{0%{-webkit-transform:translateY(-100%);transform:translateY(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes ttb-drawer-in{0%{-webkit-transform:translateY(-100%);transform:translateY(-100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes ttb-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(-100%);transform:translateY(-100%)}}@keyframes ttb-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(-100%);transform:translateY(-100%)}}@-webkit-keyframes btt-drawer-in{0%{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@keyframes btt-drawer-in{0%{-webkit-transform:translateY(100%);transform:translateY(100%)}to{-webkit-transform:translate(0);transform:translate(0)}}@-webkit-keyframes btt-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(100%);transform:translateY(100%)}}@keyframes btt-drawer-out{0%{-webkit-transform:translate(0);transform:translate(0)}to{-webkit-transform:translateY(100%);transform:translateY(100%)}}@-webkit-keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes nprogress-spinner{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}.icon.outbound{color:#aaa;display:inline-block;vertical-align:middle;position:relative;top:-1px}.nav-links{display:inline-block}.nav-links a{line-height:1.4rem;color:inherit}.nav-links a.router-link-active,.nav-links a:hover{color:#3eaf7c}.nav-links .nav-item{position:relative;display:inline-block;margin-left:1.5rem;line-height:2rem}.nav-links .nav-item:first-child{margin-left:0}@media (max-width:850px){.nav-links .nav-item{margin-left:0}}@media (min-width:850px){.nav-links a.router-link-active,.nav-links a:hover{color:#2c3e50}}.navbar{padding:.7rem 1.5rem;line-height:2.2rem}.navbar a{display:inline-block}.navbar .links{padding-left:1.5rem;box-sizing:border-box;background-color:#fff;white-space:nowrap;font-size:.9rem;position:absolute;right:1.5rem;top:.7rem;display:-webkit-box;display:flex}@media (max-width:850px){.navbar{padding-left:4rem}.navbar .can-hide{display:none}.navbar .links{padding-left:1.5rem}}.page-nav{max-width:740px;margin:0 auto;padding:2rem 2.5rem}@media (max-width:959px){.page-nav{padding:2rem}}@media (max-width:419px){.page-nav{padding:1.5rem}}.page-nav{padding-top:1rem;padding-bottom:0}.page-nav .inner{min-height:2rem;margin-top:0;border-top:1px solid #eaecef;padding-top:1rem;overflow:auto}.page-nav .next{float:right}.page{padding-bottom:2rem;overflow-x:hidden;display:block}@media only screen and (min-device-width:768px) and (max-device-width:1024px){.page{padding-bottom:20rem!important}}@media screen and (min-width:1200px){.theme-default-content:not(.custom){max-width:1300px!important}}.theme-default-content .content__default{position:relative}.theme-default-content .content__default pre{position:relative!important;padding-top:40px!important}.theme-default-content .content__default pre:after{content:"";position:absolute;top:9px;left:12px;z-index:1;width:10px;height:10px;border-radius:50%;background:#fc625d;box-shadow:20px 0#fdbc40,40px 0#35cd4b}@media screen and (min-width:700px){.theme-default-content .content__default h2{display:-webkit-inline-box;display:inline-flex;-webkit-box-align:center;align-items:center;font-weight:700;background:#ef7060;color:#fff;padding:3px 10px 4px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px;font-size:20px}.theme-default-content .content__default h2:after{content:"";display:inline-block;vertical-align:bottom;border-bottom:36px solid #efebe9;border-right:20px solid transparent;position:relative;left:32px;top:1px}.theme-default-content .content__default h2:before{content:"";border-bottom:2px solid #ef7060;width:100%;display:block;height:10px;position:absolute;margin-top:32px}}.theme-default-content .content__default code{color:#c7254e;background-color:#f9f2f4;font-size:14px;border-radius:5px;padding-left:5px;padding-right:5px;margin:auto 3px}.theme-default-content .content__default blockquote{padding:2px 16px;color:#555;border-left:5px solid #ef7060;background:#fff9f9;font-size:1rem}@-webkit-keyframes upDown{0%{-webkit-transform:translateY(5px);transform:translateY(5px)}25%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(5px);transform:translateY(5px)}75%{-webkit-transform:translateY(0);transform:translateY(0)}to{-webkit-transform:translateY(5px);transform:translateY(5px)}}@keyframes upDown{0%{-webkit-transform:translateY(5px);transform:translateY(5px)}25%{-webkit-transform:translateY(0);transform:translateY(0)}50%{-webkit-transform:translateY(5px);transform:translateY(5px)}75%{-webkit-transform:translateY(0);transform:translateY(0)}to{-webkit-transform:translateY(5px);transform:translateY(5px)}}.sidebar-group:not(.collapsable) .sidebar-heading:not(.clickable){cursor:auto;color:inherit}.sidebar-heading{color:#2c3e50;-webkit-transition:color .15s ease;transition:color .15s ease;cursor:pointer;font-size:1.1em;font-weight:700;padding:.35rem 1.5rem .35rem 1.25rem;width:100%;box-sizing:border-box;margin:0;border-left:.25rem solid transparent}.sidebar-heading.open,.sidebar-heading:hover{color:inherit}.sidebar-group-items{-webkit-transition:height .1s ease-out;transition:height .1s ease-out;font-size:.95em;overflow:hidden}.sidebar .sidebar-sub-headers{padding-left:1rem;font-size:.95em}a.sidebar-link{font-size:1em;font-weight:400;color:#2c3e50;border-left:.25rem solid transparent;padding:.35rem 1rem .35rem 1.25rem;line-height:1.4;width:100%;box-sizing:border-box}a.sidebar-link:hover{color:#3eaf7c}a.sidebar-link.active{font-weight:600;color:#3eaf7c;border-left-color:#3eaf7c}.sidebar-group a.sidebar-link{padding-left:2rem}.sidebar-sub-headers a.sidebar-link{padding-top:.25rem;padding-bottom:.25rem;border-left:none}.sidebar-sub-headers a.sidebar-link.active{font-weight:500}.sidebar ul{padding:0;margin:0;list-style-type:none}.sidebar a{display:inline-block}.sidebar>.sidebar-links{padding:1.5rem 0}.sidebar>.sidebar-links>li:not(:first-child){margin-top:.75rem}@media (max-width:850px){.sidebar>.sidebar-links{padding:1rem 0}}@-webkit-keyframes move{0%{-webkit-transform:translate(-175px) scale(1);transform:translate(-175px) scale(1)}50%{-webkit-transform:translate(-87px) scaleY(.5);transform:translate(-87px) scaleY(.5)}to{-webkit-transform:translate(0) scale(1);transform:translate(0) scale(1)}}@keyframes move{0%{-webkit-transform:translate(-175px) scale(1);transform:translate(-175px) scale(1)}50%{-webkit-transform:translate(-87px) scaleY(.5);transform:translate(-87px) scaleY(.5)}to{-webkit-transform:translate(0) scale(1);transform:translate(0) scale(1)}}.posr{position:relative}pre[class*=language-]{color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.function,.token.number{color:#f08d49}.token.class-name{color:#f8c555}.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator{color:#67cdcc}.theme-default-content code{padding:.25rem .5rem}.theme-default-content pre[class*=language-]{line-height:1.4;padding:1.25rem 1.5rem;margin:.85rem 0;background-color:#282c34;border-radius:6px;overflow:auto}.theme-default-content pre[class*=language-] code{color:#fff;padding:0;background-color:transparent;border-radius:0}div[class*=language-]{position:relative;background-color:#282c34;border-radius:6px}div[class*=language-] pre[class*=language-]{background:transparent;position:relative;z-index:1}div[class*=language-]:before{position:absolute;z-index:3;top:.8em;right:1em;font-size:.75rem;color:hsla(0,0%,100%,.4)}div[class~=language-js]:before{content:"js"}.theme-default-content:not(.custom){max-width:740px;margin:0 auto;padding:2rem 2.5rem}@media (max-width:959px){.theme-default-content:not(.custom){padding:2rem}}@media (max-width:419px){.theme-default-content:not(.custom){padding:1.5rem}}body,html{padding:0;margin:0;background-color:#fff}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:16px;color:#2c3e50}.page{padding-left:20rem}.navbar{z-index:20;right:0;height:3.6rem;background-color:#fff;box-sizing:border-box;border-bottom:1px solid #eaecef}.navbar{position:fixed;top:0;left:0}.sidebar{font-size:16px;background-color:#fff;width:20rem;position:fixed;z-index:10;margin:0;top:3.6rem;left:0;bottom:0;box-sizing:border-box;border-right:1px solid #eaecef;overflow-y:auto}.theme-default-content:not(.custom)>:first-child{margin-top:3.6rem}.theme-default-content:not(.custom) a:hover{text-decoration:underline}a{font-weight:500;text-decoration:none}a{color:#3eaf7c}blockquote{margin:1rem 0}blockquote>p{margin:0}ul{padding-left:1.2em}h2,h3{font-weight:600;line-height:1.25}h1:hover .header-anchor,h2:hover .header-anchor,h3:hover .header-anchor,h4:hover .header-anchor,h5:hover .header-anchor,h6:hover .header-anchor{opacity:1}h2{font-size:1.65rem;padding-bottom:.3rem;border-bottom:1px solid #eaecef}h3{font-size:1.35rem}a.header-anchor{font-size:.85em;float:left;margin-left:-.87em;padding-right:.23em;margin-top:.125em;opacity:0}a.header-anchor:hover{text-decoration:none}code{font-family:source-code-pro,Menlo,Monaco,Consolas,Courier New,monospace}p,ul{line-height:1.7}@media (max-width:959px){.sidebar{font-size:15px;width:16.4rem}.page{padding-left:16.4rem}}@media (max-width:850px){.sidebar{top:0;padding-top:3.6rem;transform:translateX(-100%);transition:transform .2s ease}.page{padding-left:0}}@media (max-width:419px){.theme-default-content div[class*=language-]{margin:.85rem -1.5rem;border-radius:0}}</style>
  <style type="text/css"></style><meta name="description" content="移动端相关"><link rel="icon" href="data:image/png;base64,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"><style>.sf-hidden{display:none!important}</style><link rel="canonical" href="https://interview2.poetries.top/fe-mobile-docs/pwa-docs/workbox/20-Workbox 详解篇 8 缓存更新广播.html"><meta http-equiv="content-security-policy" content="default-src 'none'; font-src 'self' data:; img-src 'self' data:; style-src 'unsafe-inline'; media-src 'self' data:; script-src 'unsafe-inline' data:;"><style>img[src="data:,"],source[src="data:,"]{display:none!important}</style></head>
  <body class>
    <div id="app"><div class="theme-container posr"><div><header class="navbar"> 
          <div class="sidebar-button" style="
          width: 1rem;
      "><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div>  <div class="links" style="max-width:1176px"> <nav class="nav-links can-hide"><div class="nav-item"><div><a href="./fe-mobile-docs-h5-docs-1-%E5%A4%A7%E5%8E%82%20H5%20%E5%BC%80%E5%8F%91%E6%A6%82%E8%BF%B0.html" class="nav-link">大厂H5开发
  </a></div></div><div class="nav-item"><div><a href="./fe-mobile-docs-weapp-principle-1-%E9%87%8D%E6%96%B0%E8%AE%A4%E8%AF%86%E5%B0%8F%E7%A8%8B%E5%BA%8F.html" class="nav-link">小程序原理
  </a></div></div><div class="nav-item"><div><a href="./fe-mobile-docs-weapp-docs-2-%E5%9F%BA%E7%A1%80%E7%AF%87%201_%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86.html" class="nav-link">小程序实践
  </a></div></div><div class="nav-item"><div><a href="./fe-mobile-docs-docs-canvas.html" class="nav-link">Canvas学习
  </a></div></div><div class="nav-item"><div><a href="./fe-mobile-docs-docs-taro.html" class="nav-link">Taro原理
  </a></div></div><div class="nav-item"><div><a href="./fe-mobile-docs-pwa-docs-base-01-%E5%9F%BA%E7%A1%80%E7%AF%87%201%20Manifest%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.html" class="nav-link">深入浅出PWA
  </a></div></div><div class="nav-item"><div><a href="./fe-mobile-docs-uniapp-docs-base-01-%E5%BC%80%E7%AF%87_%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%A0%E5%BF%85%E9%A1%BB%E5%AD%A6Uniapp%E5%BC%80%E5%8F%91.html" class="nav-link">Uniapp实战
  </a></div></div> <!----></nav> </div></header></div> <div class="sidebar-mask sf-hidden"></div> <aside class="sidebar"><nav class="nav-links sf-hidden"> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="./fe-mobile-docs-pwa-docs-base-01-%E5%9F%BA%E7%A1%80%E7%AF%87%201%20Manifest%20%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.html" class="sidebar-link">基础篇 1 Manifest 配置文件</a></li><li><a href="./fe-mobile-docs-pwa-docs-base-02-%E5%9F%BA%E7%A1%80%E7%AF%87%202%20Service%20Worker.html" class="sidebar-link">基础篇 2 Service Worker</a></li><li><a href="./fe-mobile-docs-pwa-docs-base-03-%E5%9F%BA%E7%A1%80%E7%AF%87%203%20%E7%A6%BB%E7%BA%BF%E5%AD%98%E5%82%A8.html" class="sidebar-link">基础篇 3 离线存储</a></li><li><a href="./fe-mobile-docs-pwa-docs-base-04-%E5%9F%BA%E7%A1%80%E7%AF%87%204%20%E5%90%8E%E5%8F%B0%E5%90%8C%E6%AD%A5.html" class="sidebar-link">基础篇 4 后台同步</a></li><li><a href="./fe-mobile-docs-pwa-docs-base-05-%E5%9F%BA%E7%A1%80%E7%AF%87%205%20%E6%8E%A8%E9%80%81%E9%80%9A%E7%9F%A5.html" class="sidebar-link">基础篇 5 推送通知</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>实战</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="./fe-mobile-docs-pwa-docs-action-06-%E5%AE%9E%E6%88%98%E7%AF%87%201%20%E6%A6%82%E8%BF%B0.html" class="sidebar-link">实战篇 1 概述</a></li><li><a href="./fe-mobile-docs-pwa-docs-action-07-%E5%AE%9E%E6%88%98%E7%AF%87%202%20%E9%A2%84%E7%BC%93%E5%AD%98.html" class="sidebar-link">实战篇 2 预缓存</a></li><li><a href="./fe-mobile-docs-pwa-docs-action-08-%E5%AE%9E%E6%88%98%E7%AF%87%203%20%E5%BA%94%E7%94%A8%20Shell.html" class="sidebar-link">实战篇 3 应用 Shell</a></li><li><a href="./fe-mobile-docs-pwa-docs-action-09-%E5%AE%9E%E6%88%98%E7%AF%87%204%20%E5%AF%BC%E8%88%AA%E9%A2%84%E5%8A%A0%E8%BD%BD.html" class="sidebar-link">实战篇 4 导航预加载</a></li><li><a href="./fe-mobile-docs-pwa-docs-action-10-%E5%AE%9E%E6%88%98%E7%AF%87%205%20%E8%AF%B7%E6%B1%82%E7%AD%96%E7%95%A5.html" class="sidebar-link">实战篇 5 请求策略</a></li><li><a href="./fe-mobile-docs-pwa-docs-action-11-%E5%AE%9E%E6%88%98%E7%AF%87%206%20%E7%BC%93%E5%AD%98%E7%BD%AE%E6%8D%A2%E7%AD%96%E7%95%A5.html" class="sidebar-link">实战篇 6 缓存置换策略</a></li><li><a href="./fe-mobile-docs-pwa-docs-action-12-%E5%AE%9E%E6%88%98%E7%AF%87%207%20Service%20Worker%20%E6%9B%B4%E6%96%B0.html" class="sidebar-link">实战篇 7 Service Worker 更新</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>workbox</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="./fe-mobile-docs-pwa-docs-workbox-13-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%201%20%E6%A6%82%E8%BF%B0.html" class="sidebar-link">Workbox 详解篇 1 概述</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-14-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%202%20%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE.html" class="sidebar-link">Workbox 详解篇 2 基本配置</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-15-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%203%20%E9%A2%84%E7%BC%93%E5%AD%98.html" class="sidebar-link">Workbox 详解篇 3 预缓存</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-16-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%204%20%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE.html" class="sidebar-link">Workbox 详解篇 4 路由配置</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-17-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%205%20%E8%AF%B7%E6%B1%82%20&amp;%20%E7%BC%93%E5%AD%98%E7%BD%AE%E6%8D%A2%E7%AD%96%E7%95%A5.html" class="sidebar-link">Workbox 详解篇 5 请求 &amp; 缓存置换策略</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-18-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%206%20%E5%AF%BC%E8%88%AA%E9%A2%84%E5%8A%A0%E8%BD%BD.html" class="sidebar-link">Workbox 详解篇 6 导航预加载</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-19-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%207%20%E5%8F%AF%E7%BC%93%E5%AD%98%E5%AF%B9%E8%B1%A1.html" class="sidebar-link">Workbox 详解篇 7 可缓存对象</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html" class="active sidebar-link">Workbox 详解篇 8 缓存更新广播</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" class="sidebar-link">基本使用</a></li><li class="sidebar-sub-header"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF" class="active sidebar-link">消息总线</a></li><li class="sidebar-sub-header"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#%E6%80%BB%E7%BB%93" class="sidebar-link">总结</a></li></ul></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-21-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%209%20%E5%90%8E%E5%8F%B0%E5%90%8C%E6%AD%A5.html" class="sidebar-link">Workbox 详解篇 9 后台同步</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-22-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%2010%20%E6%8F%92%E4%BB%B6.html" class="sidebar-link">Workbox 详解篇 10 插件</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-23-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%2011%20Workbox%20Window.html" class="sidebar-link">Workbox 详解篇 11 Workbox Window</a></li><li><a href="./fe-mobile-docs-pwa-docs-workbox-24-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%2012%20Workbox%20Build.html" class="sidebar-link">Workbox 详解篇 12 Workbox Build</a></li></ul></section></li></ul> </aside> <main class="page"> <div id="container" class="theme-default-content"><div class="content__default"><blockquote><p>为了加快页面渲染，我们常使用先缓存后网络（<code>StaleWhileRevalidate</code>）策略将本地缓存作为响应快速返回给用户，同时从网络中获取最新资源并更新缓存，最后通知页面进行更新。由于 Service Worker 与页面运行在不同的线程环境中，故需要一种机制来保证缓存更新后页面能够及时得到通知。在 Workbox 中，我们可以使用 <code>workbox-broadcast-cache-update</code>模块来实现这一需求，接下来就让我们一起来探究该模块的使用</p></blockquote> <h2 id="基本使用"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" class="header-anchor">#</a> 基本使用</h2> <div class="language-js extra-class"><pre class="language-js code-copy-added"><code>workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token string">'/articles'</span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>StaleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>broadcastUpdate<span class="token punctuation">.</span>Plugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        channelName<span class="token punctuation">:</span> <span class="token string">'workbox'</span><span class="token punctuation">,</span>
        deferNoticationTimeout<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        headersToCheck<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token string">'ETag'</span><span class="token punctuation">,</span> <span class="token string">'Last-Modified'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><blockquote><p>上例中，当请求 <code>/articles</code> 的缓存更新后，只要新响应头信息中 <code>Content-Length</code>、<code>ETag</code> 或 <code>Last-Modified</code> 的值有任何一个与旧响应头信息中相关属性的值不一致，便会向频道 workbox 广播缓存更新消息。其中 <code>workbox.broadcastUpdate.Plugin</code> 构造函数的参数为含有以下属性的对象：</p></blockquote> <ul><li><code>channelName</code>：频道名称（默认值为 <code>workbox</code>）。</li> <li><code>headersToCheck</code>：出于效率的考量，Workbox 通过比对前后两个响应的头信息来判断响应是否更新，我们可通过该属性来设置需比对的头信息（默认值为 <code>content-length</code>、<code>etag</code>和 <code>last-modified</code>）。</li> <li><code>deferNoticationTimeout</code>：当请求为导航请求，且相关缓存有所更新时，Workbox 会延迟广播直到页面准备妥当（页面可通过调用 <code>navigator.serviceWorker.controller.postMessage</code> 发送 <code>{type: 'WINDOW_READY', meta: 'workbox-window'}</code> 消息来告知 <code>Workbox</code>），同时也为了避免无限制地等待，我们可通过该属性以要求 Workbox 在等待指定时间后，无论是否收到页面通知，都将立即广播更新消息（默认值为 <code>1000</code>，单位为毫秒）</li></ul> <blockquote><p>由于 <code>workbox.broadcastUpdate.Plugin</code> 内部使用了 <code>workbox.broadcastUpdate.BroadcastCacheUpdate</code>来处理缓存更新广播，因此在自定义的请求策略中，可直接使用它来处理缓存更新广播，比如：</p></blockquote> <div class="language-js extra-class"><pre class="language-js code-copy-added"><code><span class="token keyword">const</span> broadcastUpdate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>broadcastUpdate<span class="token punctuation">.</span>BroadcastCacheUpdate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  channelName<span class="token punctuation">:</span> <span class="token string">'workbox'</span><span class="token punctuation">,</span>
  deferNoticationTimeout<span class="token punctuation">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
  headersToCheck<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Content-Length'</span><span class="token punctuation">,</span> <span class="token string">'ETag'</span><span class="token punctuation">,</span> <span class="token string">'Last-Modified'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> cacheName <span class="token operator">=</span> <span class="token string">'cacheName'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'http:/127.0.0.1:8080/articles'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cache <span class="token operator">=</span> <span class="token keyword">await</span> caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>cacheName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> oldResponse <span class="token operator">=</span> <span class="token keyword">await</span> cache<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> newResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

broadcastUpdate<span class="token punctuation">.</span><span class="token function">notifyIfUpdated</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  oldResponse<span class="token punctuation">,</span>
  newResponse<span class="token punctuation">,</span>
  url<span class="token punctuation">,</span>
  cacheName
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><blockquote><p>上例中，我们通过调用 <code>workbox.broadcastUpdate.BroadcastCacheUpdate</code> 实例的 <code>notifyIfUpdated</code> 方法，以便在缓存更新后广播相关信息。该方法的参数为含有以下属性的对象：</p></blockquote> <ul><li><code>oldResponse</code>：已经缓存的请求响应。</li> <li><code>newResponse</code>：新的将要被缓存的请求响应。</li> <li><code>url</code>：请求的 URL（字符串，非 URL 类型）。</li> <li><code>cacheName</code>：缓存名称。</li> <li><code>event</code>：触发请求的 FetchEvent 对象，该属性为可选属性。</li></ul> <blockquote><p>上文对 Service Worker 中的处理进行了介绍，此处需要牢记：无论是使用 <code>workbox.broadcastUpdate.Plugin</code>还是 <code>workbox.broadcastUpdate.BroadcastCacheUpdate</code>，由于它们都是根据响应头的差异来判断缓存是否需要更新，因此如果我们将它们作用在不透明响应上，更新广播将永远不会触发。</p></blockquote> <blockquote><p>完成了 Service Worker 中的设置，接下来就需要在页面中监听此消息，相关代码如下：</p></blockquote> <div class="language-js extra-class"><pre class="language-js code-copy-added"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'BroadcastChannel'</span> <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> workboxChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">'workbox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  workboxChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Receive message from ServiceWorker:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Receive message from ServiceWorker:'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><blockquote><p>上例中，如果浏览器支持 BroadcastChannel API，则监听 BroadcastChannel 的 message 事件，否则监听 <code>navigator.serviceWorker</code> 的 message 事件，回调参数 event.data 为含有以下属性的对象：</p></blockquote> <ul><li><code>type</code>：消息类型，值为常量 <code>CACHE_UPDATED</code>。</li> <li><code>meta</code>：元属性，值为常量 <code>workbox-broadcast-cache-update</code>。</li> <li><code>payload</code>：缓存相关信息，值为含有以下属性的对象：</li> <li><code>cacheName</code>：缓存名称。</li> <li><code>updatedUrl</code>：已更新的缓存地址（字符串，非 URL 类型）</li></ul> <h2 id="消息总线"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#%E6%B6%88%E6%81%AF%E6%80%BB%E7%BA%BF" class="header-anchor">#</a> 消息总线</h2> <blockquote><p>上文提到了 <code>BroadcastChannel</code>，通过它我们可以实现 <code>Service Worker</code> 与页面的相互通信，当然也可使用 <code>postMessage</code>或 <code>MessageChannel</code> 来实现此功能。究竟这三种技术有何区别？它们各自的适用场景又该如何？本节将为一一为大家进行介绍。</p></blockquote> <h3 id="postmessage"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#postmessage" class="header-anchor">#</a> postMessage</h3> <blockquote><p>通过 postMessage 可实现不同窗口（比如：iframe、WebWorker 或 ServiceWorker）间的相互通信。同时，由于该方法允许来自不同源的脚本进行有效且安全地通信，它也常作为跨域通信的有效解决方案。此方法的使用如下：</p></blockquote> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>otherWindow.postMessage(message, targetOrigin, transferList);
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><ul><li><code>otherWindow</code>：其他窗口的一个引用，比如 <code>iframe</code> 的 <code>contentWindow</code>属性、执行 <code>window.open</code> 所返回的窗口对象、已命名或数值索引的 <code>window.frames</code>、<code>Worker</code> 或 <code>ServiceWorker</code>实例。</li> <li><code>message</code>：需要发送给 <code>otherWindow</code> 的数据，其值为可被结构化克隆算法序列化的所有类型。</li> <li><code>targetOrigin</code>：通过该参数可控制消息能够发送给哪些窗口；只有目标窗口的协议、Host 地址及端口号与该参数的值完全相同，此窗口才能接收信息；当值为 * 时，则表明任何窗口都可以接收信息。</li> <li><code>transferList</code>：可选参数，<code>Transferable</code> 对象数组，这些对象的所有权将转移给消息的接收方，并且在所有权转移之后，消息的发送方将不能再操作该对象，否则将抛出异常。</li></ul> <blockquote><p>于 Worker 或 ServiceWorker 与注册它的页面遵循同源策略，因此它们的实例方法 postMessage 的参数与上述有所差异，依次为 message 和 transferList，类型则与上述相关参数相同。</p></blockquote> <p>目标窗口可通过监听 message 事件来接收消息：</p> <div class="language- extra-class"><pre class="language-text code-copy-added"><code>addEventListener('message', event =&gt; {
  // doSomething...
});
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><blockquote><p>回调参数 event 为 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MessageEvent" target="_blank" rel="noopener noreferrer">MessageEvent 对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，主要包含以下属性：</p></blockquote> <ul><li><code>data</code>：从其他窗口发送的消息对象。</li> <li><code>origin</code>：消息发送窗口的源。</li> <li><code>source</code>：消息发送窗口的引用。</li></ul> <h3 id="messagechannel"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#messagechannel" class="header-anchor">#</a> MessageChannel</h3> <blockquote><p>除了 postMessage，我们也可以使用 MessageChannel 来实现不同窗口间的相互通信，它与 postMessage 的主要差异有：</p></blockquote> <ul><li><code>MessageChannel</code> 的通信双方必须遵循同源策略，不能进行跨域通信。</li> <li><code>MessageChannel</code> 无需维护通信双方实体的引用。</li> <li><code>MessageChannel</code> 的使用如下所示：</li></ul> <div class="language-js extra-class"><pre class="language-js code-copy-added"><code><span class="token comment">// index.html</span>
<span class="token keyword">const</span> messageChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MessageChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
messageChannel<span class="token punctuation">.</span>port1<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// doSomething...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>
  <span class="token string">'Message from UI thread'</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>messageChannel<span class="token punctuation">.</span>port2<span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//sw.js</span>
self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// doSomething...</span>
  event<span class="token punctuation">.</span>ports<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Message back from Service Worker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><blockquote><p>上例中，我们在页面中创建了信道实例 messageChannel，然后通过信道的两个端口 messageChannel.port1 和 messageChannel.port2 完成不同窗口的通信。端口的使用规则如下：</p></blockquote> <ul><li>创建信道的窗口（此处为 index.html）使用端口 port1，并设置此端口的 onmessage 属性来接收另一端口发送的消息;</li> <li>调用 postMessage（此处为 <code>navigator.serviceWorker.controller.postMessage</code>）方法将端口 port2 作为参数 <code>transferList</code> 的值，以消息的形式发送给另一个窗口（此处为 <code>sw.js</code>）；</li> <li>在 <code>sw.js</code> 中监听 message 事件，并通过 <code>event.ports[0]</code> 来获得从 index.html 传递过来的信道端口，然后便可调用端口的 <code>postMessage</code> 方法来发送消息给 <code>index.html</code>。</li></ul> <p>其中：</p> <ul><li><code>event</code> 参数为 MessageEvent 对象，主要属性上文已进行说明，此处不再重述。</li> <li><code>postMessage</code> 方法的参数依次为 message 和 transferList，具体类型上文已进行说明，此处不再重述。</li></ul> <h3 id="broadcastchannel"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#broadcastchannel" class="header-anchor">#</a> BroadcastChannel</h3> <blockquote><p>虽然利用 MessageChannel，我们无需维护通信双方实体的引用便可完成双方的通信，但它依旧存在以下问题：</p></blockquote> <ul><li>由于通信双方必须持有同一信道的不同端口，所以创建信道的一方必须通过某种方式将端口传递给另一方，这在无形之中增加了代码的复杂度。</li> <li>由于同一通道只有两个端口，如果通信实体大于两个，那么 <code>MessageChannel</code> 将无法处理。</li></ul> <p>我们可以使用 <code>BroadcastChannel</code> 来解决上述问题，比如：</p> <div class="language-js extra-class"><pre class="language-js code-copy-added"><code><span class="token comment">//index.html</span>
<span class="token keyword">const</span> broadcastChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">'workbox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broadcastChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//...doSomething</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broadcastChannel<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Message from UI thread'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//sw.js</span>
<span class="token keyword">const</span> broadcastChannel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastChannel</span><span class="token punctuation">(</span><span class="token string">'workbox'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broadcastChannel<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span>  <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">//...doSomething</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
broadcastChannel<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'Message back from Service Worker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code><div data-v-49140617 class="code-copy"><svg data-v-49140617 xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="hover" style="bottom:7.5px"><path data-v-49140617 fill="none" d="M0 0h24v24H0z"></path> <path data-v-49140617 fill="#3eaf7c" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4l6 6v10c0 1.1-.9 2-2 2H7.99C6.89 23 6 22.1 6 21l.01-14c0-1.1.89-2 1.99-2h7zm-1 7h5.5L14 6.5V12z"></path></svg> <span data-v-49140617 class style="bottom:7.5px">
        @程序员poetry: 代码已经复制到剪贴板
    </span></div></pre></div><blockquote><p>上例中，我们在 index.html 和 sw.js 中创建了具有相同名称 workbox 的广播信道实例 broadcastChannel，然后通过调用实例方法 postMessage 来发送消息，并监听实例的 message 事件来接收消息。只要保证信道具有相同的名称，通信的任何一方无需再向另一方传递任何信息，便能接收到发送方发送的消息。基于此，该机制常作为不同窗口通信的首选方案，但它依旧存在以下限制：</p></blockquote> <ul><li><code>BroadcastChannel</code> 的通信双方必须遵循同源策略，不能进行跨域通信。</li> <li>不同于 <code>MessageChannel</code>，如果消息接收方在发送方发送消息之后才监听 message 事件，那么接收方将无法获得之前发送的消息。</li></ul> <p>其中：</p> <ul><li><code>event</code> 参数为 MessageEvent 对象，主要属性上文已进行说明，此处不再重述。</li> <li><code>postMessage</code> 方法的参数只有 message，具体类型上文已进行说明，此处不再重述。</li></ul> <h2 id="总结"><a href="./fe-mobile-docs-pwa-docs-workbox-20-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%208%20%E7%BC%93%E5%AD%98%E6%9B%B4%E6%96%B0%E5%B9%BF%E6%92%AD.html#%E6%80%BB%E7%BB%93" class="header-anchor">#</a> 总结</h2> <blockquote><p>本章我们首先对 <code>workbox-broadcast-cache-update</code> 模块进行了介绍，通过该模块，我们可以在请求缓存发生更新后，页面主线程能够及时得到通知；然后，我们对不同窗口通信的常见技术进行了介绍：</p></blockquote> <ul><li><code>postMessage</code>：主要用于跨域通信，但通信双方需要各自维护通信另一方实体的引用；</li> <li><code>MessageChannel</code>：无需维护通信双方实体的引用，但不能处理跨域通信，通信双方需要各自持有信道的一个端口，也由于一个信道只有两个端口，因此无法处理两个以上通信实体的相互通信；主要用于一对一，且消息接收方在发送方发送消息之后才设置 onmessage 参数时，依旧需要接收到之前发送的消息的场景。</li> <li><code>BroadcastChannel</code>：使用方式最为简单，且可以支持任意窗口（大于等于二）的相互通信，但不能处理跨域通信，并且如果消息接收方在发送方发送消息之后才监听 message 事件，那么接收方将无法获得之前发送的消息。</li></ul> <p>至此，我们完成了 Workbox 中缓存处理相关所有内容的学习，下一章，我们将对 Workbox 的后台同步进行介绍</p></div> <!----> <!----></div>  <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="./fe-mobile-docs-pwa-docs-workbox-19-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%207%20%E5%8F%AF%E7%BC%93%E5%AD%98%E5%AF%B9%E8%B1%A1.html" class="prev">Workbox 详解篇 7 可缓存对象</a></span> <span class="next"><a href="./fe-mobile-docs-pwa-docs-workbox-21-Workbox%20%E8%AF%A6%E8%A7%A3%E7%AF%87%209%20%E5%90%8E%E5%8F%B0%E5%90%8C%E6%AD%A5.html" class>Workbox 详解篇 9 后台同步</a>
      →
    </span></p></div>  </main> <div class="el-dialog__wrapper" style="display:none"></div> <div class="el-dialog__wrapper" style="display:none"></div> <div class="el-dialog__wrapper" style="display:none"></div> <div class="el-dialog__wrapper" style="display:none"></div></div><div class="global-ui"><!----></div></div>
    
  

</body></html>